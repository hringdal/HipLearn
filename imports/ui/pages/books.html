<template name="listBooks">
    <h1>Books</h1>
    <div class="ui divided items">
        {{#each books}}
            {{> book}}
            <div class="book-slider" style="display: none" data-id="{{_id}}">
                {{> showBook}}
            </div>
        {{/each}}
        <a href="{{pathFor 'books.new' courseId=_id }}" class="ui green basic button"><i class="book icon"></i>
            Create a New Book
        </a>
        <a href="{{pathFor 'books.new.isbn' courseId=_id }}" class="ui basic button"><i class="book icon"></i>
            Create Book from ISBN code
        </a>
    </div>

</template>

<template name="book">
    <div class="item">
        <div class="image">
            <img src="/images/book-placeholder.png">
        </div>
        <div class="content">
            <a class="header book-preview" data-id="{{_id}}">{{title}}</a>
            <div class="meta">
                <span>Description</span>
            </div>
            <div class="description">
                <p>
                    {{description}}
                </p>
            </div>
            <div class="extra">
                <span>Chapters: {{chapters.length}}</span>
                <div class="book-preview ui button" data-id="{{_id}}">Show</div>
                <button class="ui basic right floated icon negative button delete-book">
                    <i class="trash icon"></i>
                </button>
                <a href="{{pathFor 'books.edit' _id=this._id}}" title="{{title}}"
                   class="ui right floated secondary button">
                    Edit book
                    <i class="right chevron icon"></i>
                </a>
            </div>
        </div>
    </div>
    <!--<tr>
        <td>
            <i class="book icon"></i>
            {{title}} ({{chapters.length}})
        </td>
        <td class="right aligned">
            <a href="{{pathFor 'books.edit' _id=this._id}}" title="{{title}}" class="ui basic button">
                Edit Book
            </a>
            <button class="ui basic icon negative button delete-book">
                <i class="trash icon"></i>
            </button>
        </td>
    </tr>-->
</template>

<template name="listStudentBooks">
    <div class="ui segment">
        <h1>{{name}}</h1>
        <button class="ui small unfollow-course right floated basic negative icon button">Unfollow course <i
                class="remove icon"></i></button>
        <h1>Overview of books</h1>
        {{> progressBar}}
        {{#if hasBooks}}
            {{#each books}}
                {{> showBook}}
            {{/each}}
        {{else}}
            <p>Oops! This course currently has no listed books.<br>
                Contact your lecturer to get your curriculum included.</p>
        {{/if}}
    </div>
</template>

<template name="showBook">
    <h2>Title: {{title}}</h2>
    <div class="ui mini horizontal statistic">
        <div class="value">
            {{uncheckedCount}}
        </div>
        <div class="label">
            Chapters left
        </div>
    </div>
    <div class="ui relaxed list">
        {{#each chapter in chapters}}
            <div class="item level-{{chapter.level}}">
                <button data-id="{{chapter._id}}"
                        class="ui small basic icon button chapter-status {{#if checked
                                                                               chapter._id}}purple{{/if}}">
                    {{#if checked chapter._id}}
                        <i class="checkmark icon"></i>
                    {{else}}
                        <i class="angle right icon"></i>
                    {{/if}}
                </button>
                {{chapter.title}}
            </div>
        {{/each}}
    </div>
    <div class="ui hidden divider"></div>
</template>

<template name="editBook">
    <div class="ui container" style="margin-top: 47px">
        <div class="ui segment">
            <h3>Editing book</h3>
            <h2>{{getBook.title}}</h2>
            {{#autoForm collection=getBooks type="method-update" meteormethod="books.update" doc=getBook
                        id="updateBook"}}
                {{> afQuickField name='title'}}
                {{> afQuickField name='course_id'}}
                {{> afQuickField name='description' rows=3 }}
                <h4 class="ui header">Chapters</h4>
                {{> afArrayField name='chapters' template="bookForm"}}
                <button type="submit" class="ui positive button">Update</button>
                <a href="{{pathForCourse}}" class="ui basic button">Cancel</a>
            {{/autoForm}}
        </div>
    </div>
</template>

<template name="newBook">
    <div id="new-book" class="ui segment">
        <h2>Creating New Book</h2>
        {{#autoForm collection=getBooks type="method" meteormethod="books.insert" id="createBook"}}
            {{> afQuickField name='title'}}
            {{> afQuickField name='description' rows=3 }}
            <h4 class="ui header">Chapters</h4>
            {{> afArrayField name='chapters' template="bookForm"}}
            <button type="submit" class="ui positive button">Insert</button>
            <a href='{{pathForCourse}}' class="ui show-new-book basic button">Cancel</a>
        {{/autoForm}}
    </div>
</template>

<template name="newBookISBN">
    <div class="ui segment">
        <h2>Creating New Book from ISBN Code</h2>
        {{#autoForm schema=isbnSchema type="method" meteormethod="books.insertISBN" id="createBookISBN"}}
            {{> afQuickField name='isbn'}}
            <button type="submit" class="ui positive button">Insert</button>
            <a href='{{pathForCourse}}' class="ui basic button">Cancel</a>
        {{/autoForm}}
    </div>
</template>

<template name="afArrayField_bookForm">
    <!--<h4 class="ui top attached bheader">
        {{afFieldLabelText name=this.atts.name}}
    </h4>-->
    <div class="ui basic segment">
        {{#if afFieldIsInvalid name=this.atts.name}}
            <div class="ui pointing red basic label">
                {{{afFieldMessage name=this.atts.name}}}
            </div>
        {{/if}}
        {{#afEachArrayItem name=this.atts.name minCount=this.atts.minCount maxCount=this.atts.maxCount}}
            <div class="field autoform-array-item">
                {{#if afArrayFieldHasMoreThanMinimum name=../atts.name minCount=../atts.minCount
                      maxCount=../atts.maxCount}}
                    <div class="ui mini red corner label autoform-remove-item">
                        <i class="icon minus"></i>
                    </div>
                {{/if}}
                {{> afObjectField name=this.name label=false options=afOptionsFromSchema}}
            </div>
        {{/afEachArrayItem}}
        {{#if afArrayFieldHasLessThanMaximum name=this.atts.name minCount=this.atts.minCount
              maxCount=this.atts.maxCount}}
            <div class="field">
                <div class="ui small green icon button autoform-add-item" data-autoform-field="{{this.atts.name}}"
                     data-autoform-minCount="{{this.atts.minCount}}" data-autoform-maxCount="{{this.atts.maxCount}}">
                    <i class="icon plus"></i>
                </div>
            </div>
        {{/if}}
    </div>
</template>